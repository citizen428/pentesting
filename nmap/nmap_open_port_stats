#!/usr/bin/env ruby

=begin
A modified version of http://www.pentesterscripting.com/mapping/nmap_open_port_stats
which was orginally written by Robin Wood

Change to be more idiomatic Ruby and also modified the script's output.
=end

unless File.exist? ARGV[0]
  puts "Input file not found"
  exit 1
end

hits = Hash.new { |h, k| h[k] = 0 }
protocols = {}
format = "%-6s %-6s %-6s"

File.open(ARGV[0], 'r').each do |line|
  line.chomp!

  if /^([0-9]*)\/(tcp|udp)\s*open/ =~ line
    port = $1.to_i
    protocols[port] = $2
    hits[port] += 1
  end
end

puts format % %w(port proto count)
puts '-' * 20
hits.sort_by { |k, v| k }.each do |port, count|
  puts format % [port, protocols[port], count]
end
